# Супер Лабораторная работа 4 (Боевое крещение, предпоследняя)
___
## В чем суть?
Эта лаба - ваше первое боевое крещение.

Наш бизнес-стартап, в котором мы работаем, набирает обороты - уже во всю идут переговоры с поставщиками, нам нужно выводить наш веб-сервис на уровень MVP (minimal valuable product).

Для выхода на уровень MVP нам нужен следующий функционал:
- Возможность оставлять комменты, для получения обратной связи
- Возможность для клиента оставить свои данные, чтобы с ним связались

Без этого функционала смысла в сайте нет. Бизнес платит нам зарплату, поэтому мы удовлетворяем его запросы.
Если коротко, то бизнес отвечает на вопрос "что нужно?", а мы отвечаем на вопрос "как это реализовать?"

Нам надо оставить возможность редактировать витрину только авторизованным админам (это я сделал сам).
Нужно скрыть кнопки создания и редактирования от рядовых пользователей.
Также необходимо реализовать возможность оставлять комментарии авторизованным пользователям.
Еще нужно указать картинкам заданный размер на странице.
Возможность оставить свои данные мы реализуем в следующей лабе.

## Что изменилось в веб-сервисе?
Была добавлена возможность авторизации, добавлен пользователь с логином: IvanTheAdmin и паролем: password.
Также был добавлен один рядовой пользователь, его характеристики вы можете посмотреть в "миграции" 03_users_creation.py (на самом деле это еще не миграции).
Были добавлены страницы для регистрации и авторизации.
В таблицы комментов добавилось поле юзер_айди.
И появилась куча мелких изменений, которые я уже забыл.

## Что нужно сделать?
Данное задание является объемным и за один день вы не управитесь(все как на реальной работе, ведь это боевое крещение), поэтому советую разбить его выполнение на несколько дней.

На этот раз все серьезно и вы оказываетесь в боевых условиях, т.к. тимлид заболел, начал рожать и ушёл в отпуск одновременно.
На вас стоят следующие задачи:
- На главной странице задать высоту картинки не более 35% экрана в высоту.
- На странице товара задать высоту картинки не более 60% экрана в высоту.
- Добавить блок для отображения последних трех комментариев под каждым товаром на главной странице.
- Комментарий состоит из: имени пользователя, даты оставления комментария, текста комментария.
- Оформить комментарии с помощью css bootstrap (можно сделать вот такое оформление, например, https://getbootstrap.com/docs/3.4/css/#type-blockquotes).
Не забывайте, что мы используем готовую библиотеку стилей bootstrap.
- Добавить блок для отображения всех комментариев под товаром на странице товара, с таким же оформлением как на главной странице.
- Добавить textarea для оставления комментариев на странице товара, которая видна только авторизованным пользователям.

Если вас одолела паника от объема работ, то не переживайте, по сути эти задачи можно выразить в следующих шагах:

Картинки
- Создать в папке static папку styles, в ней создать файл mycss.css (или любое другое название).
- Подключить этот стиль ко всем страницам через шаблон base.html.
- Написать в нем 2 класса для картинок на главной странице и на странице товара.
- Установить в этих классах максимальную высоту в 60vh и 35vh соответственно (можете погуглить че за vh).
- Добавить классы к существующим классам в картинках в шаблоне index и post

Скрыть элементы
- Нужно пойти в шаблон base.html и посмотреть, как там регулируется отображение элементов в зависимости от того, залогинен ли юзер.
- После этого нужно в шаблонах index.html и base.html скрыть кнопку используя current_user.is_admin() (current_user дает ссылку на текущего залогиненного юзера, а функцию is_admin() я написал сам в модели пользователя)

Комменты
- Добавить в модель comment функцию create_comment (подсмотреть аналогию в модели post, например)
- Создать шаблон comments.html, подсмотреть как создавать форму для отправки данных в шаблоне edit.html, секции про удаление поста. Только в этом случае action будет равно чему-то типа "{{ url_for('.create_comment', id=post['id']) }}"
- Создать в шаблоне комменты таким образом, чтобы комменты брались из переменной post['comments'], а textbox для ввода коментов отображался в зависимости от того, установлена ли переменная show_input в True либо в False
- Добавить этот шаблон с помощью include в нужные места в шаблонах index и post (как сделать это, вы можете прочитать вот тут https://pythonru.com/uroki/7-osnovy-shablonizatora-jinja)
- Создать контроллер comment_controller.py
- Создать в нем функцию для выборки всех комментов по списку переданных в нее post_ids с сортировкой по убыванию даты.
- Создать в main_controller функцию append_comments_to_posts(posts, comment_count), пусть она принимает посты и кол-во комментов для добавления и возвращает посты с комментами. Пусть она использует предыдущую функцию для получения всех комментов по постам и с помощью циклов перебирает все комменты, группирует их по постам, убирает лишние, если нужно.
- Использовать эту функцию внутри функций index и get_post_page контроллера main_controller. Передать переменную show_input в функцию render_template (проверьте перед этим что current_user.is_authenticated, добавление коммента должен видеть только авторизованный юзер )
- Создать функцию create_comment, которая должна сохранять коммент в БД (подсмотреть аналогию в main_controller, функции create_post, например). Она должна по итогу редиректить обратно на страницу товара. (Проверить перед выполнением, что current_user.is_authenticated, чтобы неавторизованный юзер не мог отправить такой запрос)
- Создать в файле routes.py маршрут /create_comment для создания коммента с помощью функции create_comment из контроллера

Если я что-то забыл - сорян)
Когда вы одолеете это задание, вы получите опыт решения реальных бизнес-задач, а это уже половина успеха при трудоустройстве.